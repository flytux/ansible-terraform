02:20:45 UTC [GreetingsModule] Greetings
02:20:45 UTC message: [kubesphere-master-1]
Greetings, KubeKey!
02:20:46 UTC message: [kubesphere-worker-1]
Greetings, KubeKey!
02:20:46 UTC message: [kubesphere-master-2]
Greetings, KubeKey!
02:20:46 UTC success: [kubesphere-master-1]
02:20:46 UTC success: [kubesphere-worker-1]
02:20:46 UTC success: [kubesphere-master-2]
02:20:46 UTC [NodePreCheckModule] A pre-check on nodes
02:20:46 UTC success: [kubesphere-master-1]
02:20:46 UTC success: [kubesphere-master-2]
02:20:46 UTC success: [kubesphere-worker-1]
02:20:46 UTC [ClusterPreCheckModule] Get KubeConfig file
02:20:46 UTC skipped: [kubesphere-master-2]
02:20:46 UTC success: [kubesphere-master-1]
02:20:46 UTC [ClusterPreCheckModule] Get all nodes Kubernetes version
02:20:46 UTC success: [kubesphere-worker-1]
02:20:46 UTC success: [kubesphere-master-1]
02:20:46 UTC success: [kubesphere-master-2]
02:20:46 UTC [ClusterPreCheckModule] Calculate min Kubernetes version
02:20:46 UTC skipped: [kubesphere-master-2]
02:20:46 UTC success: [kubesphere-master-1]
02:20:46 UTC [ClusterPreCheckModule] Check desired Kubernetes version
02:20:46 UTC skipped: [kubesphere-master-2]
02:20:46 UTC success: [kubesphere-master-1]
02:20:46 UTC [ClusterPreCheckModule] Check KubeSphere version
02:20:47 UTC skipped: [kubesphere-master-2]
02:20:47 UTC success: [kubesphere-master-1]
02:20:47 UTC [ClusterPreCheckModule] Check dependency matrix for KubeSphere and Kubernetes
02:20:47 UTC skipped: [kubesphere-master-2]
02:20:47 UTC skipped: [kubesphere-master-1]
02:20:47 UTC [ClusterPreCheckModule] Get kubernetes nodes status
02:20:47 UTC skipped: [kubesphere-master-2]
02:20:47 UTC success: [kubesphere-master-1]
02:20:47 UTC [SetUpgradePlanModule 1/2] Set upgrade plan
02:20:47 UTC success: [LocalHost]
02:20:47 UTC [SetUpgradePlanModule 1/2] Generate kubeadm config
02:20:47 UTC skipped: [kubesphere-master-2]
02:20:47 UTC success: [kubesphere-master-1]
02:20:47 UTC [ProgressiveUpgradeModule 1/2] Calculate next upgrade version
02:20:47 UTC success: [LocalHost]
02:20:47 UTC [ProgressiveUpgradeModule 1/2] Download installation binaries
02:20:47 UTC message: [localhost]
downloading amd64 kubeadm v1.24.1 ...
02:20:49 UTC message: [localhost]
downloading amd64 kubelet v1.24.1 ...
02:20:55 UTC message: [localhost]
downloading amd64 kubectl v1.24.1 ...
02:20:58 UTC message: [localhost]
downloading amd64 helm v3.9.0 ...
02:20:59 UTC message: [localhost]
downloading amd64 kubecni v1.2.0 ...
02:21:01 UTC message: [localhost]
downloading amd64 crictl v1.24.0 ...
02:21:02 UTC message: [localhost]
downloading amd64 etcd v3.4.13 ...
02:21:04 UTC message: [localhost]
downloading amd64 containerd 1.6.4 ...
02:21:06 UTC message: [localhost]
downloading amd64 runc v1.1.1 ...
02:21:07 UTC message: [localhost]
downloading amd64 calicoctl v3.23.2 ...
02:21:09 UTC success: [LocalHost]
02:21:09 UTC [ProgressiveUpgradeModule 1/2] Start to pull images on all nodes
02:21:09 UTC message: [kubesphere-worker-1]
downloading image: kubesphere/pause:3.7
02:21:09 UTC message: [kubesphere-master-1]
downloading image: kubesphere/pause:3.7
02:21:09 UTC message: [kubesphere-master-2]
downloading image: kubesphere/pause:3.7
02:21:14 UTC message: [kubesphere-master-2]
downloading image: kubesphere/kube-apiserver:v1.24.1
02:21:14 UTC message: [kubesphere-worker-1]
downloading image: kubesphere/kube-proxy:v1.24.1
02:21:14 UTC message: [kubesphere-master-1]
downloading image: kubesphere/kube-apiserver:v1.24.1
02:21:17 UTC message: [kubesphere-worker-1]
downloading image: coredns/coredns:1.8.6
02:21:17 UTC message: [kubesphere-master-2]
downloading image: kubesphere/kube-controller-manager:v1.24.1
02:21:17 UTC message: [kubesphere-master-1]
downloading image: kubesphere/kube-controller-manager:v1.24.1
02:21:18 UTC message: [kubesphere-worker-1]
downloading image: kubesphere/k8s-dns-node-cache:1.15.12
02:21:19 UTC message: [kubesphere-master-2]
downloading image: kubesphere/kube-scheduler:v1.24.1
02:21:19 UTC message: [kubesphere-master-1]
downloading image: kubesphere/kube-scheduler:v1.24.1
02:21:20 UTC message: [kubesphere-worker-1]
downloading image: calico/kube-controllers:v3.23.2
02:21:21 UTC message: [kubesphere-worker-1]
downloading image: calico/cni:v3.23.2
02:21:21 UTC message: [kubesphere-master-1]
downloading image: kubesphere/kube-proxy:v1.24.1
02:21:22 UTC message: [kubesphere-master-2]
downloading image: kubesphere/kube-proxy:v1.24.1
02:21:23 UTC message: [kubesphere-worker-1]
downloading image: calico/node:v3.23.2
02:21:24 UTC message: [kubesphere-worker-1]
downloading image: calico/pod2daemon-flexvol:v3.23.2
02:21:24 UTC message: [kubesphere-master-1]
downloading image: coredns/coredns:1.8.6
02:21:24 UTC message: [kubesphere-master-2]
downloading image: coredns/coredns:1.8.6
02:21:26 UTC message: [kubesphere-master-1]
downloading image: kubesphere/k8s-dns-node-cache:1.15.12
02:21:26 UTC message: [kubesphere-master-2]
downloading image: kubesphere/k8s-dns-node-cache:1.15.12
02:21:27 UTC message: [kubesphere-master-1]
downloading image: calico/kube-controllers:v3.23.2
02:21:27 UTC message: [kubesphere-master-2]
downloading image: calico/kube-controllers:v3.23.2
02:21:29 UTC message: [kubesphere-master-1]
downloading image: calico/cni:v3.23.2
02:21:29 UTC message: [kubesphere-master-2]
downloading image: calico/cni:v3.23.2
02:21:30 UTC message: [kubesphere-master-1]
downloading image: calico/node:v3.23.2
02:21:31 UTC message: [kubesphere-master-2]
downloading image: calico/node:v3.23.2
02:21:32 UTC message: [kubesphere-master-1]
downloading image: calico/pod2daemon-flexvol:v3.23.2
02:21:32 UTC message: [kubesphere-master-2]
downloading image: calico/pod2daemon-flexvol:v3.23.2
02:21:34 UTC success: [kubesphere-worker-1]
02:21:34 UTC success: [kubesphere-master-1]
02:21:34 UTC success: [kubesphere-master-2]
02:21:34 UTC [ProgressiveUpgradeModule 1/2] Synchronize kubernetes binaries
02:21:38 UTC success: [kubesphere-master-2]
02:21:38 UTC success: [kubesphere-worker-1]
02:21:38 UTC success: [kubesphere-master-1]
02:21:38 UTC [ProgressiveUpgradeModule 1/2] Upgrade cluster on master
02:27:17 UTC [GreetingsModule] Greetings
02:27:18 UTC message: [kubesphere-master-1]
Greetings, KubeKey!
02:27:18 UTC message: [kubesphere-master-2]
Greetings, KubeKey!
02:27:18 UTC message: [kubesphere-worker-1]
Greetings, KubeKey!
02:27:18 UTC success: [kubesphere-master-1]
02:27:18 UTC success: [kubesphere-master-2]
02:27:18 UTC success: [kubesphere-worker-1]
02:27:18 UTC [NodePreCheckModule] A pre-check on nodes
02:27:18 UTC success: [kubesphere-worker-1]
02:27:18 UTC success: [kubesphere-master-2]
02:27:18 UTC success: [kubesphere-master-1]
02:27:18 UTC [ClusterPreCheckModule] Get KubeConfig file
02:27:18 UTC skipped: [kubesphere-master-1]
02:27:18 UTC success: [kubesphere-master-2]
02:27:18 UTC [ClusterPreCheckModule] Get all nodes Kubernetes version
02:27:18 UTC success: [kubesphere-worker-1]
02:27:18 UTC success: [kubesphere-master-1]
02:27:18 UTC success: [kubesphere-master-2]
02:27:18 UTC [ClusterPreCheckModule] Calculate min Kubernetes version
02:27:18 UTC skipped: [kubesphere-master-1]
02:27:18 UTC success: [kubesphere-master-2]
02:27:18 UTC [ClusterPreCheckModule] Check desired Kubernetes version
02:27:18 UTC skipped: [kubesphere-master-1]
02:27:18 UTC success: [kubesphere-master-2]
02:27:18 UTC [ClusterPreCheckModule] Check KubeSphere version
02:27:19 UTC skipped: [kubesphere-master-1]
02:27:19 UTC success: [kubesphere-master-2]
02:27:19 UTC [ClusterPreCheckModule] Check dependency matrix for KubeSphere and Kubernetes
02:27:19 UTC skipped: [kubesphere-master-1]
02:27:19 UTC skipped: [kubesphere-master-2]
02:27:19 UTC [ClusterPreCheckModule] Get kubernetes nodes status
02:27:19 UTC skipped: [kubesphere-master-1]
02:27:19 UTC success: [kubesphere-master-2]
02:27:19 UTC [SetUpgradePlanModule 1/2] Set upgrade plan
02:27:19 UTC success: [LocalHost]
02:27:19 UTC [SetUpgradePlanModule 1/2] Generate kubeadm config
02:27:19 UTC skipped: [kubesphere-master-1]
02:27:19 UTC success: [kubesphere-master-2]
02:27:19 UTC [ProgressiveUpgradeModule 1/2] Calculate next upgrade version
02:27:19 UTC success: [LocalHost]
02:27:19 UTC [ProgressiveUpgradeModule 1/2] Download installation binaries
02:27:19 UTC message: [localhost]
downloading amd64 kubeadm v1.24.1 ...
02:27:19 UTC message: [localhost]
kubeadm is existed
02:27:19 UTC message: [localhost]
downloading amd64 kubelet v1.24.1 ...
02:27:20 UTC message: [localhost]
kubelet is existed
02:27:20 UTC message: [localhost]
downloading amd64 kubectl v1.24.1 ...
02:27:20 UTC message: [localhost]
kubectl is existed
02:27:20 UTC message: [localhost]
downloading amd64 helm v3.9.0 ...
02:27:20 UTC message: [localhost]
helm is existed
02:27:20 UTC message: [localhost]
downloading amd64 kubecni v1.2.0 ...
02:27:20 UTC message: [localhost]
kubecni is existed
02:27:20 UTC message: [localhost]
downloading amd64 crictl v1.24.0 ...
02:27:20 UTC message: [localhost]
crictl is existed
02:27:20 UTC message: [localhost]
downloading amd64 etcd v3.4.13 ...
02:27:20 UTC message: [localhost]
etcd is existed
02:27:20 UTC message: [localhost]
downloading amd64 containerd 1.6.4 ...
02:27:20 UTC message: [localhost]
containerd is existed
02:27:20 UTC message: [localhost]
downloading amd64 runc v1.1.1 ...
02:27:20 UTC message: [localhost]
runc is existed
02:27:20 UTC message: [localhost]
downloading amd64 calicoctl v3.23.2 ...
02:27:20 UTC message: [localhost]
calicoctl is existed
02:27:20 UTC success: [LocalHost]
02:27:20 UTC [ProgressiveUpgradeModule 1/2] Start to pull images on all nodes
02:27:20 UTC message: [kubesphere-master-2]
downloading image: kubesphere/pause:3.7
02:27:20 UTC message: [kubesphere-master-1]
downloading image: kubesphere/pause:3.7
02:27:20 UTC message: [kubesphere-worker-1]
downloading image: kubesphere/pause:3.7
02:27:25 UTC message: [kubesphere-worker-1]
downloading image: kubesphere/kube-proxy:v1.24.1
02:27:25 UTC message: [kubesphere-master-2]
downloading image: kubesphere/kube-apiserver:v1.24.1
02:27:25 UTC message: [kubesphere-master-1]
downloading image: kubesphere/kube-apiserver:v1.24.1
02:27:27 UTC message: [kubesphere-master-2]
downloading image: kubesphere/kube-controller-manager:v1.24.1
02:27:27 UTC message: [kubesphere-worker-1]
downloading image: coredns/coredns:1.8.6
02:27:28 UTC message: [kubesphere-master-1]
downloading image: kubesphere/kube-controller-manager:v1.24.1
02:27:29 UTC message: [kubesphere-worker-1]
downloading image: kubesphere/k8s-dns-node-cache:1.15.12
02:27:30 UTC message: [kubesphere-master-2]
downloading image: kubesphere/kube-scheduler:v1.24.1
02:27:30 UTC message: [kubesphere-master-1]
downloading image: kubesphere/kube-scheduler:v1.24.1
02:27:30 UTC message: [kubesphere-worker-1]
downloading image: calico/kube-controllers:v3.23.2
02:27:32 UTC message: [kubesphere-master-2]
downloading image: kubesphere/kube-proxy:v1.24.1
02:27:32 UTC message: [kubesphere-worker-1]
downloading image: calico/cni:v3.23.2
02:27:33 UTC message: [kubesphere-master-1]
downloading image: kubesphere/kube-proxy:v1.24.1
02:27:34 UTC message: [kubesphere-worker-1]
downloading image: calico/node:v3.23.2
02:27:35 UTC message: [kubesphere-master-2]
downloading image: coredns/coredns:1.8.6
02:27:35 UTC message: [kubesphere-worker-1]
downloading image: calico/pod2daemon-flexvol:v3.23.2
02:27:36 UTC message: [kubesphere-master-1]
downloading image: coredns/coredns:1.8.6
02:27:36 UTC message: [kubesphere-master-2]
downloading image: kubesphere/k8s-dns-node-cache:1.15.12
02:27:38 UTC message: [kubesphere-master-1]
downloading image: kubesphere/k8s-dns-node-cache:1.15.12
02:27:38 UTC message: [kubesphere-master-2]
downloading image: calico/kube-controllers:v3.23.2
02:27:39 UTC message: [kubesphere-master-1]
downloading image: calico/kube-controllers:v3.23.2
02:27:39 UTC message: [kubesphere-master-2]
downloading image: calico/cni:v3.23.2
02:27:40 UTC message: [kubesphere-master-1]
downloading image: calico/cni:v3.23.2
02:27:41 UTC message: [kubesphere-master-2]
downloading image: calico/node:v3.23.2
02:27:42 UTC message: [kubesphere-master-1]
downloading image: calico/node:v3.23.2
02:27:42 UTC message: [kubesphere-master-2]
downloading image: calico/pod2daemon-flexvol:v3.23.2
02:27:43 UTC message: [kubesphere-master-1]
downloading image: calico/pod2daemon-flexvol:v3.23.2
02:27:45 UTC success: [kubesphere-worker-1]
02:27:45 UTC success: [kubesphere-master-2]
02:27:45 UTC success: [kubesphere-master-1]
02:27:45 UTC [ProgressiveUpgradeModule 1/2] Synchronize kubernetes binaries
02:27:50 UTC success: [kubesphere-master-2]
02:27:50 UTC success: [kubesphere-worker-1]
02:27:50 UTC success: [kubesphere-master-1]
02:27:50 UTC [ProgressiveUpgradeModule 1/2] Upgrade cluster on master
02:31:02 UTC success: [kubesphere-master-2]
02:31:02 UTC success: [kubesphere-master-1]
02:31:02 UTC [ProgressiveUpgradeModule 1/2] Get kubernetes cluster status
02:31:02 UTC stdout: [kubesphere-master-2]
v1.24.1
02:31:02 UTC stdout: [kubesphere-master-2]
kubesphere-master-1   v1.24.1    [map[address:192.168.100.151 type:InternalIP] map[address:kubesphere-master-1 type:Hostname]]
kubesphere-master-2   v1.24.1    [map[address:192.168.100.152 type:InternalIP] map[address:kubesphere-master-2 type:Hostname]]
kubesphere-worker-1   v1.23.10   [map[address:192.168.100.181 type:InternalIP] map[address:kubesphere-worker-1 type:Hostname]]
02:31:02 UTC stdout: [kubesphere-master-2]
W0920 02:31:02.293117   10505 common.go:83] your configuration file uses a deprecated API spec: "kubeadm.k8s.io/v1beta2". Please use 'kubeadm config migrate --old-config old.yaml --new-config new.yaml', which will write the new, similar spec using a newer API version.
W0920 02:31:02.294595   10505 common.go:83] your configuration file uses a deprecated API spec: "kubeadm.k8s.io/v1beta2". Please use 'kubeadm config migrate --old-config old.yaml --new-config new.yaml', which will write the new, similar spec using a newer API version.
W0920 02:31:02.296193   10505 utils.go:69] The recommended value for "clusterDNS" in "KubeletConfiguration" is: [10.233.0.10]; the provided value is: [169.254.25.10]
[upload-certs] Storing the certificates in Secret "kubeadm-certs" in the "kube-system" Namespace
[upload-certs] Using certificate key:
b4e230d652d420368f1a11e7736877169f49c27414da0a9e2b50616be80f3300
02:31:02 UTC stdout: [kubesphere-master-2]
secret/kubeadm-certs patched
02:31:02 UTC stdout: [kubesphere-master-2]
secret/kubeadm-certs patched
02:31:02 UTC stdout: [kubesphere-master-2]
secret/kubeadm-certs patched
02:31:02 UTC stdout: [kubesphere-master-2]
0e0eo7.cdywk3sqx2j6ro7k
02:31:02 UTC stdout: [kubesphere-master-1]
v1.24.1
02:31:02 UTC stdout: [kubesphere-master-1]
kubesphere-master-1   v1.24.1    [map[address:192.168.100.151 type:InternalIP] map[address:kubesphere-master-1 type:Hostname]]
kubesphere-master-2   v1.24.1    [map[address:192.168.100.152 type:InternalIP] map[address:kubesphere-master-2 type:Hostname]]
kubesphere-worker-1   v1.23.10   [map[address:192.168.100.181 type:InternalIP] map[address:kubesphere-worker-1 type:Hostname]]
02:31:02 UTC stdout: [kubesphere-master-1]
W0920 02:31:02.692431   12731 common.go:83] your configuration file uses a deprecated API spec: "kubeadm.k8s.io/v1beta2". Please use 'kubeadm config migrate --old-config old.yaml --new-config new.yaml', which will write the new, similar spec using a newer API version.
W0920 02:31:02.692946   12731 common.go:83] your configuration file uses a deprecated API spec: "kubeadm.k8s.io/v1beta2". Please use 'kubeadm config migrate --old-config old.yaml --new-config new.yaml', which will write the new, similar spec using a newer API version.
W0920 02:31:02.693851   12731 utils.go:69] The recommended value for "clusterDNS" in "KubeletConfiguration" is: [10.233.0.10]; the provided value is: [169.254.25.10]
[upload-certs] Storing the certificates in Secret "kubeadm-certs" in the "kube-system" Namespace
[upload-certs] Using certificate key:
869188a38c007f71700dbf02e2106b604c40b45462689d078bf02a062a0876c1
02:31:02 UTC stdout: [kubesphere-master-1]
secret/kubeadm-certs patched
02:31:02 UTC stdout: [kubesphere-master-1]
secret/kubeadm-certs patched
02:31:02 UTC stdout: [kubesphere-master-1]
secret/kubeadm-certs patched
02:31:02 UTC stdout: [kubesphere-master-1]
bdgbni.f90lz3i931cy4udj
02:31:02 UTC success: [kubesphere-master-2]
02:31:02 UTC success: [kubesphere-master-1]
02:31:02 UTC [ProgressiveUpgradeModule 1/2] Upgrade cluster on worker
02:31:03 UTC stdout: [kubesphere-worker-1]
[upgrade] Reading configuration from the cluster...
[upgrade] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'
W0920 02:31:03.035041    8497 utils.go:69] The recommended value for "clusterDNS" in "KubeletConfiguration" is: [10.233.0.10]; the provided value is: [169.254.25.10]
[preflight] Running pre-flight checks
[preflight] Skipping prepull. Not a control plane node.
[upgrade] Skipping phase. Not a control plane node.
[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"
[upgrade] The configuration for this node was successfully updated!
[upgrade] Now you should go ahead and upgrade the kubelet package using your package manager.
02:31:14 UTC success: [kubesphere-worker-1]
02:31:14 UTC skipped: [kubesphere-master-2]
02:31:14 UTC [ProgressiveUpgradeModule 1/2] Reconfigure CoreDNS
02:31:14 UTC stdout: [kubesphere-master-2]
deployment.apps/coredns patched (no change)
02:31:14 UTC stdout: [kubesphere-master-2]
service "kube-dns" deleted
02:31:14 UTC stdout: [kubesphere-master-2]
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist
02:31:14 UTC message: [kubesphere-master-2]
create coredns service failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl apply -f /etc/kubernetes/coredns-svc.yaml" 
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist: Process exited with status 1
02:31:14 UTC retry: [kubesphere-master-2]
02:31:19 UTC stdout: [kubesphere-master-2]
Error from server (NotFound): services "kube-dns" not found
02:31:19 UTC stdout: [kubesphere-master-2]
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist
02:31:19 UTC message: [kubesphere-master-2]
create coredns service failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl apply -f /etc/kubernetes/coredns-svc.yaml" 
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist: Process exited with status 1
02:31:19 UTC retry: [kubesphere-master-2]
02:31:25 UTC stdout: [kubesphere-master-2]
Error from server (NotFound): services "kube-dns" not found
02:31:25 UTC stdout: [kubesphere-master-2]
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist
02:31:25 UTC message: [kubesphere-master-2]
create coredns service failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl apply -f /etc/kubernetes/coredns-svc.yaml" 
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist: Process exited with status 1
02:31:25 UTC message: [kubesphere-master-2]
re-config coredns failed: 
failed: [kubesphere-master-2] [OverrideCoreDNSService] exec failed after 3 retries: create coredns service failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl apply -f /etc/kubernetes/coredns-svc.yaml" 
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist: Process exited with status 1
02:31:25 UTC retry: [kubesphere-master-2]
02:31:30 UTC stdout: [kubesphere-master-2]
deployment.apps/coredns patched (no change)
02:31:30 UTC stdout: [kubesphere-master-2]
Error from server (NotFound): services "kube-dns" not found
02:31:30 UTC stdout: [kubesphere-master-2]
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist
02:31:30 UTC message: [kubesphere-master-2]
create coredns service failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl apply -f /etc/kubernetes/coredns-svc.yaml" 
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist: Process exited with status 1
02:31:30 UTC retry: [kubesphere-master-2]
02:31:35 UTC stdout: [kubesphere-master-2]
Error from server (NotFound): services "kube-dns" not found
02:31:35 UTC stdout: [kubesphere-master-2]
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist
02:31:35 UTC message: [kubesphere-master-2]
create coredns service failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl apply -f /etc/kubernetes/coredns-svc.yaml" 
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist: Process exited with status 1
02:31:35 UTC retry: [kubesphere-master-2]
02:31:40 UTC stdout: [kubesphere-master-2]
Error from server (NotFound): services "kube-dns" not found
02:31:40 UTC stdout: [kubesphere-master-2]
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist
02:31:40 UTC message: [kubesphere-master-2]
create coredns service failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl apply -f /etc/kubernetes/coredns-svc.yaml" 
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist: Process exited with status 1
02:31:40 UTC message: [kubesphere-master-2]
re-config coredns failed: 
failed: [kubesphere-master-2] [OverrideCoreDNSService] exec failed after 3 retries: create coredns service failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl apply -f /etc/kubernetes/coredns-svc.yaml" 
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist: Process exited with status 1
02:31:40 UTC retry: [kubesphere-master-2]
02:31:45 UTC stdout: [kubesphere-master-2]
deployment.apps/coredns patched (no change)
02:31:45 UTC stdout: [kubesphere-master-2]
Error from server (NotFound): services "kube-dns" not found
02:31:45 UTC stdout: [kubesphere-master-2]
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist
02:31:45 UTC message: [kubesphere-master-2]
create coredns service failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl apply -f /etc/kubernetes/coredns-svc.yaml" 
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist: Process exited with status 1
02:31:45 UTC retry: [kubesphere-master-2]
02:31:50 UTC stdout: [kubesphere-master-2]
Error from server (NotFound): services "kube-dns" not found
02:31:50 UTC stdout: [kubesphere-master-2]
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist
02:31:50 UTC message: [kubesphere-master-2]
create coredns service failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl apply -f /etc/kubernetes/coredns-svc.yaml" 
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist: Process exited with status 1
02:31:50 UTC retry: [kubesphere-master-2]
02:31:56 UTC stdout: [kubesphere-master-2]
Error from server (NotFound): services "kube-dns" not found
02:31:56 UTC stdout: [kubesphere-master-2]
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist
02:31:56 UTC message: [kubesphere-master-2]
create coredns service failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl apply -f /etc/kubernetes/coredns-svc.yaml" 
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist: Process exited with status 1
02:31:56 UTC message: [kubesphere-master-2]
re-config coredns failed: 
failed: [kubesphere-master-2] [OverrideCoreDNSService] exec failed after 3 retries: create coredns service failed: Failed to exec command: sudo -E /bin/bash -c "/usr/local/bin/kubectl apply -f /etc/kubernetes/coredns-svc.yaml" 
error: the path "/etc/kubernetes/coredns-svc.yaml" does not exist: Process exited with status 1
02:31:56 UTC failed: [kubesphere-master-2]
02:31:56 UTC skipped: [kubesphere-master-1]
02:58:46 UTC [GreetingsModule] Greetings
02:58:47 UTC message: [kubesphere-worker-1]
Greetings, KubeKey!
02:58:47 UTC message: [kubesphere-master-1]
Greetings, KubeKey!
02:58:47 UTC message: [kubesphere-master-2]
Greetings, KubeKey!
02:58:47 UTC success: [kubesphere-worker-1]
02:58:47 UTC success: [kubesphere-master-1]
02:58:47 UTC success: [kubesphere-master-2]
02:58:47 UTC [NodePreCheckModule] A pre-check on nodes
02:58:48 UTC success: [kubesphere-worker-1]
02:58:48 UTC success: [kubesphere-master-1]
02:58:48 UTC success: [kubesphere-master-2]
02:58:48 UTC [ClusterPreCheckModule] Get KubeConfig file
02:58:48 UTC skipped: [kubesphere-master-2]
02:58:48 UTC success: [kubesphere-master-1]
02:58:48 UTC [ClusterPreCheckModule] Get all nodes Kubernetes version
02:58:48 UTC success: [kubesphere-worker-1]
02:58:48 UTC success: [kubesphere-master-2]
02:58:48 UTC success: [kubesphere-master-1]
02:58:48 UTC [ClusterPreCheckModule] Calculate min Kubernetes version
02:58:48 UTC skipped: [kubesphere-master-2]
02:58:48 UTC success: [kubesphere-master-1]
02:58:48 UTC [ClusterPreCheckModule] Check desired Kubernetes version
02:58:48 UTC skipped: [kubesphere-master-2]
02:58:48 UTC success: [kubesphere-master-1]
02:58:48 UTC [ClusterPreCheckModule] Check KubeSphere version
02:58:48 UTC skipped: [kubesphere-master-2]
02:58:48 UTC success: [kubesphere-master-1]
02:58:48 UTC [ClusterPreCheckModule] Check dependency matrix for KubeSphere and Kubernetes
02:58:48 UTC skipped: [kubesphere-master-2]
02:58:48 UTC skipped: [kubesphere-master-1]
02:58:48 UTC [ClusterPreCheckModule] Get kubernetes nodes status
02:58:48 UTC skipped: [kubesphere-master-2]
02:58:48 UTC success: [kubesphere-master-1]
02:58:48 UTC [SetUpgradePlanModule 1/2] Set upgrade plan
02:58:48 UTC success: [LocalHost]
02:58:48 UTC [SetUpgradePlanModule 1/2] Generate kubeadm config
02:58:48 UTC skipped: [kubesphere-master-2]
02:58:48 UTC success: [kubesphere-master-1]
02:58:48 UTC [ProgressiveUpgradeModule 1/2] Calculate next upgrade version
02:58:48 UTC success: [LocalHost]
02:58:48 UTC [ProgressiveUpgradeModule 1/2] Download installation binaries
02:58:48 UTC message: [localhost]
downloading amd64 kubeadm v1.24.1 ...
02:58:49 UTC message: [localhost]
kubeadm is existed
02:58:49 UTC message: [localhost]
downloading amd64 kubelet v1.24.1 ...
02:58:49 UTC message: [localhost]
kubelet is existed
02:58:49 UTC message: [localhost]
downloading amd64 kubectl v1.24.1 ...
02:58:49 UTC message: [localhost]
kubectl is existed
02:58:49 UTC message: [localhost]
downloading amd64 helm v3.9.0 ...
02:58:49 UTC message: [localhost]
helm is existed
02:58:49 UTC message: [localhost]
downloading amd64 kubecni v1.2.0 ...
02:58:49 UTC message: [localhost]
kubecni is existed
02:58:49 UTC message: [localhost]
downloading amd64 crictl v1.24.0 ...
02:58:49 UTC message: [localhost]
crictl is existed
02:58:49 UTC message: [localhost]
downloading amd64 etcd v3.4.13 ...
02:58:49 UTC message: [localhost]
etcd is existed
02:58:49 UTC message: [localhost]
downloading amd64 containerd 1.6.4 ...
02:58:49 UTC message: [localhost]
containerd is existed
02:58:49 UTC message: [localhost]
downloading amd64 runc v1.1.1 ...
02:58:49 UTC message: [localhost]
runc is existed
02:58:49 UTC message: [localhost]
downloading amd64 calicoctl v3.23.2 ...
02:58:49 UTC message: [localhost]
calicoctl is existed
02:58:49 UTC success: [LocalHost]
02:58:49 UTC [ProgressiveUpgradeModule 1/2] Start to pull images on all nodes
02:58:49 UTC message: [kubesphere-worker-1]
downloading image: kubesphere/pause:3.7
02:58:49 UTC message: [kubesphere-master-2]
downloading image: kubesphere/pause:3.7
02:58:49 UTC message: [kubesphere-master-1]
downloading image: kubesphere/pause:3.7
02:58:54 UTC message: [kubesphere-master-2]
downloading image: kubesphere/kube-apiserver:v1.24.1
02:58:54 UTC message: [kubesphere-master-1]
downloading image: kubesphere/kube-apiserver:v1.24.1
02:58:54 UTC message: [kubesphere-worker-1]
downloading image: kubesphere/kube-proxy:v1.24.1
02:58:56 UTC message: [kubesphere-master-2]
downloading image: kubesphere/kube-controller-manager:v1.24.1
02:58:57 UTC message: [kubesphere-master-1]
downloading image: kubesphere/kube-controller-manager:v1.24.1
02:58:57 UTC message: [kubesphere-worker-1]
downloading image: coredns/coredns:1.8.6
02:58:58 UTC message: [kubesphere-worker-1]
downloading image: kubesphere/k8s-dns-node-cache:1.15.12
02:58:59 UTC message: [kubesphere-master-2]
downloading image: kubesphere/kube-scheduler:v1.24.1
02:58:59 UTC message: [kubesphere-master-1]
downloading image: kubesphere/kube-scheduler:v1.24.1
02:59:00 UTC message: [kubesphere-worker-1]
downloading image: calico/kube-controllers:v3.23.2
02:59:01 UTC message: [kubesphere-worker-1]
downloading image: calico/cni:v3.23.2
02:59:01 UTC message: [kubesphere-master-2]
downloading image: kubesphere/kube-proxy:v1.24.1
02:59:01 UTC message: [kubesphere-master-1]
downloading image: kubesphere/kube-proxy:v1.24.1
02:59:03 UTC message: [kubesphere-worker-1]
downloading image: calico/node:v3.23.2
02:59:04 UTC message: [kubesphere-worker-1]
downloading image: calico/pod2daemon-flexvol:v3.23.2
02:59:04 UTC message: [kubesphere-master-2]
downloading image: coredns/coredns:1.8.6
02:59:05 UTC message: [kubesphere-master-1]
downloading image: coredns/coredns:1.8.6
02:59:06 UTC message: [kubesphere-master-2]
downloading image: kubesphere/k8s-dns-node-cache:1.15.12
02:59:06 UTC message: [kubesphere-master-1]
downloading image: kubesphere/k8s-dns-node-cache:1.15.12
02:59:07 UTC message: [kubesphere-master-2]
downloading image: calico/kube-controllers:v3.23.2
02:59:08 UTC message: [kubesphere-master-1]
downloading image: calico/kube-controllers:v3.23.2
02:59:09 UTC message: [kubesphere-master-2]
downloading image: calico/cni:v3.23.2
02:59:09 UTC message: [kubesphere-master-1]
downloading image: calico/cni:v3.23.2
02:59:10 UTC message: [kubesphere-master-2]
downloading image: calico/node:v3.23.2
02:59:11 UTC message: [kubesphere-master-1]
downloading image: calico/node:v3.23.2
02:59:12 UTC message: [kubesphere-master-2]
downloading image: calico/pod2daemon-flexvol:v3.23.2
02:59:12 UTC message: [kubesphere-master-1]
downloading image: calico/pod2daemon-flexvol:v3.23.2
02:59:14 UTC success: [kubesphere-worker-1]
02:59:14 UTC success: [kubesphere-master-2]
02:59:14 UTC success: [kubesphere-master-1]
02:59:14 UTC [ProgressiveUpgradeModule 1/2] Synchronize kubernetes binaries
02:59:19 UTC success: [kubesphere-worker-1]
02:59:19 UTC success: [kubesphere-master-2]
02:59:19 UTC success: [kubesphere-master-1]
02:59:19 UTC [ProgressiveUpgradeModule 1/2] Upgrade cluster on master
03:02:34 UTC success: [kubesphere-master-1]
03:02:35 UTC success: [kubesphere-master-2]
03:02:35 UTC [ProgressiveUpgradeModule 1/2] Get kubernetes cluster status
03:02:35 UTC stdout: [kubesphere-master-1]
v1.24.1
03:02:35 UTC stdout: [kubesphere-master-1]
kubesphere-master-1   v1.24.1    [map[address:192.168.100.151 type:InternalIP] map[address:kubesphere-master-1 type:Hostname]]
kubesphere-master-2   v1.24.1    [map[address:192.168.100.152 type:InternalIP] map[address:kubesphere-master-2 type:Hostname]]
kubesphere-worker-1   v1.23.10   [map[address:192.168.100.181 type:InternalIP] map[address:kubesphere-worker-1 type:Hostname]]
03:02:35 UTC stdout: [kubesphere-master-1]
W0920 03:02:35.095710   12708 common.go:83] your configuration file uses a deprecated API spec: "kubeadm.k8s.io/v1beta2". Please use 'kubeadm config migrate --old-config old.yaml --new-config new.yaml', which will write the new, similar spec using a newer API version.
W0920 03:02:35.097190   12708 common.go:83] your configuration file uses a deprecated API spec: "kubeadm.k8s.io/v1beta2". Please use 'kubeadm config migrate --old-config old.yaml --new-config new.yaml', which will write the new, similar spec using a newer API version.
W0920 03:02:35.098074   12708 utils.go:69] The recommended value for "clusterDNS" in "KubeletConfiguration" is: [10.233.0.10]; the provided value is: [169.254.25.10]
[upload-certs] Storing the certificates in Secret "kubeadm-certs" in the "kube-system" Namespace
[upload-certs] Using certificate key:
4b79300dec9444b51d96cee44fe535065f34fb0afbdb9c978f158b13e14ac58a
03:02:35 UTC stdout: [kubesphere-master-1]
secret/kubeadm-certs patched
03:02:35 UTC stdout: [kubesphere-master-1]
secret/kubeadm-certs patched
03:02:35 UTC stdout: [kubesphere-master-1]
secret/kubeadm-certs patched
03:02:35 UTC stdout: [kubesphere-master-1]
oc9pjo.gopbvpm9fyqfitpq
03:02:35 UTC stdout: [kubesphere-master-2]
v1.24.1
03:02:35 UTC stdout: [kubesphere-master-2]
kubesphere-master-1   v1.24.1    [map[address:192.168.100.151 type:InternalIP] map[address:kubesphere-master-1 type:Hostname]]
kubesphere-master-2   v1.24.1    [map[address:192.168.100.152 type:InternalIP] map[address:kubesphere-master-2 type:Hostname]]
kubesphere-worker-1   v1.23.10   [map[address:192.168.100.181 type:InternalIP] map[address:kubesphere-worker-1 type:Hostname]]
03:02:35 UTC success: [kubesphere-master-1]
03:02:35 UTC success: [kubesphere-master-2]
03:02:35 UTC [ProgressiveUpgradeModule 1/2] Upgrade cluster on worker
03:02:36 UTC stdout: [kubesphere-worker-1]
[upgrade] Reading configuration from the cluster...
[upgrade] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'
W0920 03:02:35.531712    9087 utils.go:69] The recommended value for "clusterDNS" in "KubeletConfiguration" is: [10.233.0.10]; the provided value is: [169.254.25.10]
[preflight] Running pre-flight checks
[preflight] Skipping prepull. Not a control plane node.
[upgrade] Skipping phase. Not a control plane node.
[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"
[upgrade] The configuration for this node was successfully updated!
[upgrade] Now you should go ahead and upgrade the kubelet package using your package manager.
03:02:46 UTC skipped: [kubesphere-master-2]
03:02:46 UTC success: [kubesphere-worker-1]
03:02:46 UTC [ProgressiveUpgradeModule 1/2] Reconfigure CoreDNS
03:02:46 UTC stdout: [kubesphere-master-1]
deployment.apps/coredns patched (no change)
03:02:46 UTC stdout: [kubesphere-master-1]
service "kube-dns" deleted
03:02:47 UTC stdout: [kubesphere-master-1]
service/coredns unchanged
Warning: resource clusterroles/system:coredns is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.
clusterrole.rbac.authorization.k8s.io/system:coredns configured
03:02:47 UTC stdout: [kubesphere-master-1]
Error from server (NotFound): services "kube-dns" not found
03:02:47 UTC stdout: [kubesphere-master-1]
service/coredns unchanged
clusterrole.rbac.authorization.k8s.io/system:coredns unchanged
03:02:47 UTC stdout: [kubesphere-master-1]
serviceaccount/nodelocaldns unchanged
daemonset.apps/nodelocaldns unchanged
03:02:47 UTC success: [kubesphere-master-1]
03:02:47 UTC skipped: [kubesphere-master-2]
03:02:47 UTC [ProgressiveUpgradeModule 1/2] Set current k8s version
03:02:47 UTC success: [LocalHost]
03:02:47 UTC [SetUpgradePlanModule 2/2] Set upgrade plan
03:02:47 UTC success: [LocalHost]
03:02:47 UTC [SetUpgradePlanModule 2/2] Generate kubeadm config
03:02:47 UTC skipped: [kubesphere-master-2]
03:02:47 UTC success: [kubesphere-master-1]
03:02:47 UTC [ProgressiveUpgradeModule 2/2] Calculate next upgrade version
03:02:47 UTC skipped: [LocalHost]
03:02:47 UTC [ProgressiveUpgradeModule 2/2] Download installation binaries
03:02:47 UTC skipped: [LocalHost]
03:02:47 UTC [ProgressiveUpgradeModule 2/2] Start to pull images on all nodes
03:02:47 UTC skipped: [kubesphere-worker-1]
03:02:47 UTC skipped: [kubesphere-master-2]
03:02:47 UTC skipped: [kubesphere-master-1]
03:02:47 UTC [ProgressiveUpgradeModule 2/2] Synchronize kubernetes binaries
03:02:47 UTC skipped: [kubesphere-worker-1]
03:02:47 UTC skipped: [kubesphere-master-1]
03:02:47 UTC skipped: [kubesphere-master-2]
03:02:47 UTC [ProgressiveUpgradeModule 2/2] Upgrade cluster on master
03:02:47 UTC skipped: [kubesphere-master-1]
03:02:47 UTC skipped: [kubesphere-master-2]
03:02:47 UTC [ProgressiveUpgradeModule 2/2] Get kubernetes cluster status
03:02:47 UTC skipped: [kubesphere-master-1]
03:02:47 UTC skipped: [kubesphere-master-2]
03:02:47 UTC [ProgressiveUpgradeModule 2/2] Upgrade cluster on worker
03:02:47 UTC skipped: [kubesphere-master-2]
03:02:47 UTC skipped: [kubesphere-worker-1]
03:02:47 UTC [ProgressiveUpgradeModule 2/2] Reconfigure CoreDNS
03:02:47 UTC skipped: [kubesphere-master-1]
03:02:47 UTC skipped: [kubesphere-master-2]
03:02:47 UTC [ProgressiveUpgradeModule 2/2] Set current k8s version
03:02:47 UTC skipped: [LocalHost]
03:02:47 UTC [ChownModule] Chown user $HOME/.kube dir
03:02:47 UTC success: [kubesphere-worker-1]
03:02:47 UTC success: [kubesphere-master-1]
03:02:47 UTC success: [kubesphere-master-2]
03:02:47 UTC [AutoRenewCertsModule] Generate k8s certs renew script
03:02:47 UTC success: [kubesphere-master-1]
03:02:47 UTC success: [kubesphere-master-2]
03:02:47 UTC [AutoRenewCertsModule] Generate k8s certs renew service
03:02:47 UTC success: [kubesphere-master-1]
03:02:47 UTC success: [kubesphere-master-2]
03:02:47 UTC [AutoRenewCertsModule] Generate k8s certs renew timer
03:02:47 UTC success: [kubesphere-master-1]
03:02:47 UTC success: [kubesphere-master-2]
03:02:47 UTC [AutoRenewCertsModule] Enable k8s certs renew service
03:02:48 UTC success: [kubesphere-master-2]
03:02:48 UTC success: [kubesphere-master-1]
03:02:48 UTC Pipeline[UpgradeClusterPipeline] execute successfully
